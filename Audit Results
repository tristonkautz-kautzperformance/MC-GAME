Audit Results
=============

Date: 2026-02-09
Updated: 2026-02-10

Scope
-----
- Core loop: input -> player -> world -> renderer -> HUD.
- Focus: correctness risks, perf traps, scaling constraints, regressions.

Findings (ordered by severity)
------------------------------
- Low/Design: Breaking a block always removes it; if inventory is full the block effectively disappears (no drop). Decide whether this is intended. See `src/interaction/Interaction.lua:21`.
- Scaling note: Rebuild prioritization rebuckets queued dirty entries when the player changes chunk; this is O(queue) and can be noticeable if the dirty backlog becomes large. See `src/render/ChunkRenderer.lua:92` and `src/render/ChunkRenderer.lua:236`.
- Scaling note: Alpha chunk sorting is O(n log n) in the number of visible alpha chunks; fine for now, but keep an eye on it if leaf-heavy scenes grow.

Resolved
--------
- Git is now initialized correctly in this working directory:
  - Preserved the broken `.git` folder as `.git_incomplete_backup_2026-02-10/` for safety.
  - Initialized a new repository on `main`, added a `.gitignore` for local artifacts/backups, and pushed to GitHub (`tristonkautz-kautzperformance/MC-GAME`).
- Base terrain generation no longer calls `ChunkWorld:set()` for every voxel; it writes directly into chunk storage and marks chunks dirty once at the end. See `src/world/ChunkWorld.lua:163`.
- AIR storage bloat addressed: writing AIR clears chunk slots (`nil`) to keep chunk data sparse as blocks are broken/placed. See `src/world/Chunk.lua:21`.
- Removed idle per-frame dirty-key list allocations:
  - Added `ChunkWorld:drainDirtyChunkKeys(out)` and a shared-empty fast path in `ChunkWorld:getDirtyChunkKeys()`. See `src/world/ChunkWorld.lua:5`.
  - Renderer now drains into a reusable scratch array and queues using an explicit count. See `src/render/ChunkRenderer.lua:41`.
- Renderer draw-path polish:
  - Single visibility pass over chunk meshes instead of iterating the table twice.
  - Alpha chunk meshes are drawn back-to-front to reduce blending artifacts.
  - Cached draw vectors use persistent `lovr.math.newVec3` to avoid "temporary vector from a previous frame" crashes. See `src/render/ChunkRenderer.lua:718`.
- HUD GC smoothing:
  - Reuses scratch vectors/line buffers and caches concatenated HUD text, rebuilding at a fixed interval. See `src/ui/HUD.lua:4`.
